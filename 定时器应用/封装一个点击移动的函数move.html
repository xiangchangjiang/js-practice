<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>封装一个move函数,兼容IE8</title>
  <style>
    *{margin:0;padding:0;}
  #xx,#box2{
    width:100px;
    height:100px;
    background:greenyellow;
    position:absolute;
    left:0;
  
  }
  #box2{
    background:crimson;
    top:200px;
  }

  </style>


  <script>
    window.onload=function(){
      var btn1=document.getElementById('btn1')
      var btn2=document.getElementById('btn2')
      var btn3=document.getElementById('btn3')
      var box2=document.getElementById('box2')
      var xx=document.getElementById('xx')
      btn1.onclick=function(){
        move(xx,'width',400,12,function(){move(xx,'height',250,25)})
      }

      
      btn2.onclick=function(){
        move(xx,'left',0,8,function(){move(xx,'height',300,35)})
      } 

      btn4.onclick=function(){
        move(box2,'height',400,5,function(){alert('程序执行完毕!')})
      }

      /*功能扩展:增加一个attr参数,用来传递需要改变的属性,如传入"height"  "top"等 */
      /*增加一个回调函数callback*/
      function move(obj,attr,target,speed,callback){
        var  current=parseInt(getStyle(obj,attr))
        if(target<current){
          speed=-speed 
        }
        clearInterval(obj.timer)
        /*之前用全局变量保存timer,当函数同时被多个元素使用时,后一个会终止前一个的计时器,导致一次只能使一个元素运动*
        /*在每一个调用move函数的对象中设置一个timer属性,使每一个对象独立保存自己的计时器,可以使多个元素调用函数互不影响*/
        obj.timer=setInterval(function(){
          console.log(getStyle(obj,attr))
          var oldValue=parseInt(getStyle(obj,attr))

          var newValue=oldValue+speed
          console.log(newValue)
          
          if (speed>0 && newValue>=target ||speed<0 && newValue<=target){
            newValue=target
          }
          obj.style[attr]=newValue+'px'
          if(newValue===target){
            clearInterval(obj.timer)
            callback && callback()
            // setTimeout(function(){callback && callback()},50) 
          }
        
        },50)
      }

      function getStyle(obj,name){
        return window.getComputedStyle?getComputedStyle(obj,null)[name]:obj.currentStyle[name]
      }
    }
  </script>
</head>

<body>
  <button id='btn1'>点击按钮div向右走</button>
  <button id='btn2'>点击按钮div向左走</button>
  <button id='btn4'>点击按钮box2向右走</button>
  
  <br>
  <br>
  <div id="xx"></div>
  <br><br>
  <div id='box2'>box2</div>
  <div style='width:0px;height:800px;position:absolute;left:400px;border-right:1px solid black;'></div>
</body>

</html>